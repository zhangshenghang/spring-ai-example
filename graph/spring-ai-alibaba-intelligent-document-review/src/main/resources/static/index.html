<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æ–‡æ¡£å®¡æ ¸ç³»ç»Ÿ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        textarea {
            height: 150px;
            resize: vertical;
        }
        
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .output {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #3498db;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-info {
            background-color: #d4edda;
            border-left: 3px solid #28a745;
        }
        
        .log-warning {
            background-color: #fff3cd;
            border-left: 3px solid #ffc107;
        }
        
        .log-error {
            background-color: #f8d7da;
            border-left: 3px solid #dc3545;
        }
        
        .human-feedback {
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .feedback-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .approve-btn {
            background-color: #4caf50;
        }
        
        .reject-btn {
            background-color: #f44336;
        }
        
        .modify-btn {
            background-color: #ff9800;
        }
        
        .contract-btn {
            background-color: #9c27b0;
            margin-right: 10px;
        }
        
        .contract-btn:hover {
            background-color: #7b1fa2;
        }
        
        .preview-btn {
            background-color: #607d8b;
        }
        
        .preview-btn:hover {
            background-color: #455a64;
        }
        
        .status-info {
            background-color: #e8f4fd;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .status-info pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            max-width: 100%;
            overflow-x: auto;
        }
        
        .final-content {
            background-color: #f0f8ff;
            border: 2px solid #4169e1;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .final-content h3 {
            color: #4169e1;
            margin-top: 0;
        }
        
        .content-section {
            margin-bottom: 15px;
            padding: 10px;
            background-color: white;
            border-radius: 4px;
            border-left: 3px solid #4169e1;
        }
        
        .content-section h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .human-feedback-btn {
            background-color: #e91e63;
            display: none;
        }
        
        .human-feedback-btn:hover {
            background-color: #c2185b;
        }
        
        .human-feedback-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ™ºèƒ½æ–‡æ¡£å®¡æ ¸ç³»ç»Ÿ</h1>
        <p style="text-align: center; color: #7f8c8d; margin-bottom: 30px;">
            æ¼”ç¤ºäººç±»è¿”å›èŠ‚ç‚¹ç‰¹æ€§ - AIåˆ†æ â†’ äººç±»å®¡æ ¸ â†’ æ™ºèƒ½å†³ç­–
        </p>
        
        <div class="form-group">
            <label for="documentContent">æ–‡æ¡£å†…å®¹:</label>
            <textarea id="documentContent" placeholder="è¯·è¾“å…¥éœ€è¦å®¡æ ¸çš„æ–‡æ¡£å†…å®¹...">è¿™æ˜¯ä¸€ä»½æŠ€æœ¯æœåŠ¡åˆåŒï¼Œçº¦å®šäº†ç”²æ–¹å§”æ‰˜ä¹™æ–¹å¼€å‘ä¸€å¥—ä¼ä¸šç®¡ç†ç³»ç»Ÿã€‚åˆåŒåŒ…å«ä»¥ä¸‹ä¸»è¦æ¡æ¬¾ï¼š
1. é¡¹ç›®èŒƒå›´ï¼šå¼€å‘åŒ…å«ç”¨æˆ·ç®¡ç†ã€æƒé™æ§åˆ¶ã€æ•°æ®ç»Ÿè®¡ç­‰åŠŸèƒ½çš„Webåº”ç”¨
2. å¼€å‘å‘¨æœŸï¼š6ä¸ªæœˆ
3. é¡¹ç›®è´¹ç”¨ï¼š100ä¸‡å…ƒäººæ°‘å¸
4. ä»˜æ¬¾æ–¹å¼ï¼šåˆ†ä¸‰æœŸä»˜æ¬¾ï¼Œç­¾çº¦30%ï¼Œä¸­æœŸéªŒæ”¶40%ï¼Œæœ€ç»ˆéªŒæ”¶30%
5. çŸ¥è¯†äº§æƒï¼šæºä»£ç å½’ç”²æ–¹æ‰€æœ‰
6. æŠ€æœ¯è¦æ±‚ï¼šä½¿ç”¨Java Springæ¡†æ¶ï¼ŒMySQLæ•°æ®åº“
7. è´¨é‡æ ‡å‡†ï¼šç¬¦åˆå›½å®¶è½¯ä»¶è´¨é‡æ ‡å‡†ï¼Œé€šè¿‡ç¬¬ä¸‰æ–¹æµ‹è¯•
8. è¿çº¦è´£ä»»ï¼šå»¶æœŸäº¤ä»˜æŒ‰æ—¥æ”¶å–0.1%è¿çº¦é‡‘</textarea>
        </div>
        
        <div class="form-group">
            <label for="documentType">æ–‡æ¡£ç±»å‹:</label>
            <select id="documentType">
                <option value="contract">åˆåŒ</option>
                <option value="technical">æŠ€æœ¯æ–‡æ¡£</option>
                <option value="policy">æ”¿ç­–æ–‡ä»¶</option>
                <option value="financial">è´¢åŠ¡æŠ¥å‘Š</option>
                <option value="general">é€šç”¨æ–‡æ¡£</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="urgencyLevel">ç´§æ€¥ç¨‹åº¦:</label>
            <select id="urgencyLevel">
                <option value="low">ä½</option>
                <option value="normal">ä¸­</option>
                <option value="high">é«˜</option>
                <option value="critical">ç´§æ€¥</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="threadId">ä¼šè¯ID:</label>
            <input type="text" id="threadId" value="demo_review_001" placeholder="è¾“å…¥å”¯ä¸€çš„ä¼šè¯æ ‡è¯†ç¬¦">
        </div>
        
        <button onclick="startReview()" id="startBtn">ğŸš€ å¼€å§‹å®¡æ ¸</button>
        <button onclick="reviewContract()" id="contractBtn" class="contract-btn">ğŸ“‹ å®¡æ ¸é—®é¢˜åˆåŒ</button>
        <button onclick="previewContract()" id="previewBtn" class="preview-btn">ğŸ‘ï¸ é¢„è§ˆåˆåŒ</button>
        <button onclick="triggerHumanFeedback()" id="humanFeedbackBtn" class="human-feedback-btn" style="display: none;">ğŸ¤” äººå·¥åé¦ˆ</button>
        <button onclick="getStatus()" id="statusBtn">ğŸ“Š æŸ¥çœ‹çŠ¶æ€</button>
        <button onclick="clearOutput()" id="clearBtn">ğŸ—‘ï¸ æ¸…ç©ºè¾“å‡º</button>
        
        <div id="humanFeedback" class="human-feedback" style="display: none;">
            <h3>ğŸ¤” ç­‰å¾…äººç±»å®¡æ ¸</h3>
            <p>AIåˆ†æå·²å®Œæˆï¼Œè¯·å®¡æ ¸å‘˜å¯¹ä»¥ä¸‹ç»“æœè¿›è¡Œç¡®è®¤ï¼š</p>
            <div id="aiAnalysisPreview" style="background: #f0f0f0; padding: 10px; border-radius: 4px; margin: 10px 0;"></div>
            
            <div class="form-group">
                <label for="reviewComments">å®¡æ ¸æ„è§:</label>
                <textarea id="reviewComments" placeholder="è¯·å¡«å†™æ‚¨çš„å®¡æ ¸æ„è§..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="suggestedChanges">ä¿®æ”¹å»ºè®®:</label>
                <textarea id="suggestedChanges" placeholder="å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œè¯·è¯¦ç»†è¯´æ˜ä¿®æ”¹å»ºè®®..."></textarea>
            </div>
            
            <div class="feedback-buttons">
                <button class="approve-btn" onclick="continueReview('approve')">âœ… é€šè¿‡</button>
                <button class="reject-btn" onclick="continueReview('reject')">âŒ æ‹’ç»</button>
                <button class="modify-btn" onclick="continueReview('modify')">ğŸ“ éœ€è¦ä¿®æ”¹</button>
            </div>
        </div>
        
        <div id="output" class="output" style="display: none;">
            <h3>ğŸ“‹ å®¡æ ¸æ—¥å¿—</h3>
            <div id="logContainer"></div>
        </div>
        
        <div id="statusInfo" class="status-info" style="display: none;">
            <h3>ğŸ“ˆ å½“å‰çŠ¶æ€</h3>
            <div id="statusContent"></div>
        </div>
        
        <div id="finalContent" class="final-content" style="display: none;">
            <h3>ğŸ“‹ å®¡æ ¸æœ€ç»ˆç»“æœ</h3>
            <div id="finalContentContainer"></div>
        </div>
    </div>

    <script>
        let currentThreadId = '';
        let isWaitingForHuman = false;
        let streamContent = {}; // å­˜å‚¨æµå¼å†…å®¹
        let finalResults = {}; // å­˜å‚¨æœ€ç»ˆç»“æœ

        function reviewContract() {
            const threadId = document.getElementById('threadId').value;
            
            currentThreadId = threadId;
            isWaitingForHuman = false;
            
            const contractBtn = document.getElementById('contractBtn');
            contractBtn.disabled = true;
            contractBtn.textContent = 'ğŸ”„ å®¡æ ¸ä¸­...';
            
            document.getElementById('output').style.display = 'block';
            document.getElementById('humanFeedback').style.display = 'none';
            document.getElementById('humanFeedbackBtn').style.display = 'inline-block';
            clearLogs();
            
            addLog('æ­£åœ¨å®¡æ ¸é¢„è®¾çš„é—®é¢˜åˆåŒæ–‡æ¡£...', 'info');
            
            const url = `/document/review/contract?thread_id=${threadId}`;
            
            const eventSource = new EventSource(url);
            
            eventSource.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    handleReviewEvent(data);
                } catch (e) {
                    addLog('è§£ææ•°æ®é”™è¯¯: ' + event.data, 'error');
                }
            };
            
            eventSource.onerror = function(event) {
                addLog('è¿æ¥é”™è¯¯æˆ–å®¡æ ¸å®Œæˆ', 'warning');
                eventSource.close();
                
                contractBtn.disabled = false;
                contractBtn.textContent = 'ğŸ“‹ å®¡æ ¸é—®é¢˜åˆåŒ';
                
                if (isWaitingForHuman) {
                    document.getElementById('humanFeedback').style.display = 'block';
                }
            };
        }
        
        function previewContract() {
            fetch('/document/review/contract/preview')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        addLog('é¢„è§ˆå¤±è´¥: ' + data.error, 'error');
                        return;
                    }
                    
                    document.getElementById('statusInfo').style.display = 'block';
                    document.getElementById('statusContent').innerHTML = 
                        `<h4>ğŸ“„ ${data.filename}</h4>
                         <p><strong>æè¿°:</strong> ${data.description}</p>
                         <p><strong>æ–‡æ¡£ç±»å‹:</strong> ${data.type}</p>
                         <p><strong>æ–‡æ¡£é•¿åº¦:</strong> ${data.length} å­—ç¬¦</p>
                         <hr>
                         <h5>æ–‡æ¡£å†…å®¹é¢„è§ˆ:</h5>
                         <pre style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 4px;">${data.content}</pre>`;
                    
                    // åŒæ—¶å¡«å……åˆ°æ–‡æœ¬åŒºåŸŸ
                    document.getElementById('documentContent').value = data.content;
                    document.getElementById('documentType').value = data.type;
                    document.getElementById('urgencyLevel').value = 'high';
                    
                    addLog('åˆåŒæ–‡æ¡£å·²åŠ è½½åˆ°ç¼–è¾‘åŒºåŸŸ', 'info');
                })
                .catch(error => {
                    addLog('é¢„è§ˆåˆåŒå¤±è´¥: ' + error.message, 'error');
                });
        }
        
        function startReview() {
            const content = document.getElementById('documentContent').value;
            const type = document.getElementById('documentType').value;
            const urgency = document.getElementById('urgencyLevel').value;
            const threadId = document.getElementById('threadId').value;
            
            if (!content.trim()) {
                alert('è¯·è¾“å…¥æ–‡æ¡£å†…å®¹');
                return;
            }
            
            currentThreadId = threadId;
            isWaitingForHuman = false;
            streamContent = {};
            finalResults = {};
            
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = true;
            startBtn.textContent = 'ğŸ”„ å®¡æ ¸ä¸­...';
            
            document.getElementById('output').style.display = 'block';
            document.getElementById('humanFeedback').style.display = 'none';
            document.getElementById('humanFeedbackBtn').style.display = 'inline-block';
            clearLogs();
            
            const url = `/document/review/start?document_content=${encodeURIComponent(content)}&document_type=${type}&urgency_level=${urgency}&thread_id=${threadId}`;
            
            const eventSource = new EventSource(url);
            
            eventSource.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    handleReviewEvent(data);
                } catch (e) {
                    addLog('è§£ææ•°æ®é”™è¯¯: ' + event.data, 'error');
                }
            };
            
            eventSource.onerror = function(event) {
                addLog('è¿æ¥é”™è¯¯æˆ–å®¡æ ¸å®Œæˆ', 'warning');
                eventSource.close();
                
                startBtn.disabled = false;
                startBtn.textContent = 'ğŸš€ å¼€å§‹å®¡æ ¸';
                
                if (isWaitingForHuman) {
                    document.getElementById('humanFeedback').style.display = 'block';
                } else {
                    // å¦‚æœä¸æ˜¯ç­‰å¾…äººå·¥åé¦ˆï¼Œæ˜¾ç¤ºæœ€ç»ˆç»“æœ
                    displayFinalContent();
                }
            };
        }
        
        function continueReview(action) {
            const comments = document.getElementById('reviewComments').value;
            const changes = document.getElementById('suggestedChanges').value;
            
            document.getElementById('humanFeedback').style.display = 'none';
            addLog(`äººç±»å®¡æ ¸å†³ç­–: ${action}`, 'info');
            
            if (comments) {
                addLog(`å®¡æ ¸æ„è§: ${comments}`, 'info');
            }
            
            const url = `/document/review/continue?thread_id=${currentThreadId}&action=${action}&comments=${encodeURIComponent(comments)}&suggested_changes=${encodeURIComponent(changes)}`;
            
            const eventSource = new EventSource(url);
            
            eventSource.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    handleReviewEvent(data);
                } catch (e) {
                    addLog('è§£ææ•°æ®é”™è¯¯: ' + event.data, 'error');
                }
            };
            
            eventSource.onerror = function(event) {
                addLog('å®¡æ ¸æµç¨‹å·²å®Œæˆ', 'info');
                eventSource.close();
                
                // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
                displayFinalContent();
            };
        }
        
        function handleReviewEvent(data) {
            if (data.node) {
                const nodeMessages = {
                    'content_analysis': 'ğŸ“ æ­£åœ¨è¿›è¡Œå†…å®¹åˆ†æ...',
                    'compliance_check': 'âš–ï¸ æ­£åœ¨è¿›è¡Œåˆè§„æ€§æ£€æŸ¥...',
                    'risk_assessment': 'âš ï¸ æ­£åœ¨è¿›è¡Œé£é™©è¯„ä¼°...',
                    'human_review': 'ğŸ¤” ç­‰å¾…äººç±»å®¡æ ¸ç¡®è®¤...',
                    'approval_process': 'âœ… æ­£åœ¨å¤„ç†å®¡æ‰¹æµç¨‹...',
                    'rejection_process': 'âŒ æ­£åœ¨å¤„ç†æ‹’ç»æµç¨‹...',
                    'modification_process': 'ğŸ“ æ­£åœ¨ç”Ÿæˆä¿®æ”¹æŒ‡å¯¼...',
                    'final_report': 'ğŸ“‹ æ­£åœ¨ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š...'
                };
                
                const message = nodeMessages[data.node] || `å¤„ç†èŠ‚ç‚¹: ${data.node}`;
                addLog(message, 'info');
                
                // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾äººå·¥å®¡æ ¸èŠ‚ç‚¹
                if (data.node === 'human_review') {
                    isWaitingForHuman = true;
                    
                    // æ˜¾ç¤ºAIåˆ†æç»“æœé¢„è§ˆ
                    if (data.data) {
                        let aiAnalysisText = '';
                        if (data.data.ai_analysis_result) {
                            aiAnalysisText = data.data.ai_analysis_result;
                        } else if (data.data.review_instruction) {
                            aiAnalysisText = data.data.review_instruction;
                        }
                        
                        if (aiAnalysisText) {
                            const preview = aiAnalysisText.length > 300 ? 
                                aiAnalysisText.substring(0, 300) + '...' : aiAnalysisText;
                            document.getElementById('aiAnalysisPreview').textContent = preview;
                        }
                    }
                    
                    // å»¶æ—¶æ˜¾ç¤ºäººå·¥åé¦ˆç•Œé¢ï¼Œç¡®ä¿AIåˆ†æå®Œæˆ
                    setTimeout(() => {
                        if (isWaitingForHuman) {
                            document.getElementById('humanFeedback').style.display = 'block';
                            addLog('â¸ï¸ å·¥ä½œæµå·²æš‚åœï¼Œç­‰å¾…äººå·¥å®¡æ ¸åé¦ˆ', 'warning');
                        }
                    }, 1000);
                }
                
                // å¤„ç†èŠ‚ç‚¹æ•°æ®
                if (data.data) {
                    for (const [key, value] of Object.entries(data.data)) {
                        if (typeof value === 'string' && value.length > 50) {
                            addLog(`${key}: ${value.substring(0, 100)}...`, 'info');
                            // å­˜å‚¨å®Œæ•´å†…å®¹åˆ°æœ€ç»ˆç»“æœ
                            finalResults[key] = value;
                        } else if (typeof value !== 'object') {
                            addLog(`${key}: ${value}`, 'info');
                            finalResults[key] = value;
                        }
                    }
                }
            } else {
                // æµå¼è¾“å‡ºå¤„ç†
                for (const [key, value] of Object.entries(data)) {
                    if (typeof value === 'string') {
                        // ç´¯ç§¯æµå¼å†…å®¹åˆ°æœ€ç»ˆæ˜¾ç¤ºåŒºåŸŸ
                        accumulateStreamContent(key, value);
                        addLog(`${key}: ${value}`, 'info');
                    }
                }
            }
        }
        
        function accumulateStreamContent(key, value) {
            if (!streamContent[key]) {
                streamContent[key] = '';
            }
            streamContent[key] += value;
        }
        
        function displayFinalContent() {
            const finalContentDiv = document.getElementById('finalContent');
            const containerDiv = document.getElementById('finalContentContainer');
            
            if (Object.keys(streamContent).length === 0 && Object.keys(finalResults).length === 0) {
                return; // æ²¡æœ‰å†…å®¹è¦æ˜¾ç¤º
            }
            
            let html = '';
            
            // æ˜¾ç¤ºç´¯ç§¯çš„æµå¼å†…å®¹
            for (const [key, content] of Object.entries(streamContent)) {
                if (content && content.trim()) {
                    html += `
                        <div class="content-section">
                            <h4>${getContentTitle(key)}</h4>
                            <div style="white-space: pre-wrap; word-wrap: break-word;">${content}</div>
                        </div>
                    `;
                }
            }
            
            // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
            for (const [key, value] of Object.entries(finalResults)) {
                if (value && typeof value === 'string' && value.trim()) {
                    html += `
                        <div class="content-section">
                            <h4>${getContentTitle(key)}</h4>
                            <div style="white-space: pre-wrap; word-wrap: break-word;">${value}</div>
                        </div>
                    `;
                }
            }
            
            if (html) {
                containerDiv.innerHTML = html;
                finalContentDiv.style.display = 'block';
                addLog('âœ… å®¡æ ¸ç»“æœå·²å±•ç¤º', 'info');
            }
        }
        
        function getContentTitle(key) {
            const titles = {
                'content_analysis_result': 'ğŸ“ å†…å®¹åˆ†æç»“æœ',
                'compliance_result': 'âš–ï¸ åˆè§„æ£€æŸ¥ç»“æœ',
                'ai_analysis_result': 'ğŸ¤– AIé£é™©è¯„ä¼°ç»“æœ',
                'approval_reason': 'âœ… å®¡æ‰¹å†³å®š',
                'rejection_reason': 'âŒ æ‹’ç»åŸå› ',
                'modification_guidance': 'ğŸ“ ä¿®æ”¹æŒ‡å¯¼',
                'final_report': 'ğŸ“‹ æœ€ç»ˆå®¡æ ¸æŠ¥å‘Š',
                'content_analysis_stream': 'ğŸ“ å†…å®¹åˆ†æè¿‡ç¨‹',
                'compliance_check_stream': 'âš–ï¸ åˆè§„æ£€æŸ¥è¿‡ç¨‹',
                'risk_assessment_stream': 'âš ï¸ é£é™©è¯„ä¼°è¿‡ç¨‹',
                'approval_process_stream': 'âœ… å®¡æ‰¹å¤„ç†è¿‡ç¨‹',
                'rejection_process_stream': 'âŒ æ‹’ç»å¤„ç†è¿‡ç¨‹',
                'modification_process_stream': 'ğŸ“ ä¿®æ”¹æŒ‡å¯¼è¿‡ç¨‹',
                'final_report_stream': 'ğŸ“‹ æŠ¥å‘Šç”Ÿæˆè¿‡ç¨‹'
            };
            return titles[key] || key;
        }
        
        function getStatus() {
            if (!currentThreadId) {
                alert('è¯·å…ˆå¼€å§‹ä¸€ä¸ªå®¡æ ¸æµç¨‹');
                return;
            }
            
            fetch(`/document/review/status?thread_id=${currentThreadId}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('statusInfo').style.display = 'block';
                    document.getElementById('statusContent').innerHTML = 
                        `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                })
                .catch(error => {
                    addLog('è·å–çŠ¶æ€å¤±è´¥: ' + error.message, 'error');
                });
        }
        
        function addLog(message, level = 'info') {
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${level}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }
        
        function clearOutput() {
            clearLogs();
            streamContent = {};
            finalResults = {};
            isWaitingForHuman = false;
            document.getElementById('output').style.display = 'none';
            document.getElementById('humanFeedback').style.display = 'none';
            document.getElementById('statusInfo').style.display = 'none';
            document.getElementById('finalContent').style.display = 'none';
            document.getElementById('humanFeedbackBtn').style.display = 'none';
        }
        
        function triggerHumanFeedback() {
            if (!currentThreadId) {
                addLog('âŒ è¯·å…ˆå¼€å§‹ä¸€ä¸ªå®¡æ ¸æµç¨‹', 'error');
                return;
            }
            
            // æ˜¾ç¤ºäººå·¥åé¦ˆç•Œé¢
            const humanFeedbackDiv = document.getElementById('humanFeedback');
            humanFeedbackDiv.style.display = 'block';
            
            // å¡«å……AIåˆ†æé¢„è§ˆï¼ˆå¦‚æœæœ‰æµå¼å†…å®¹ï¼‰
            const aiAnalysisPreview = document.getElementById('aiAnalysisPreview');
            let analysisContent = '';
            
            if (streamContent['ai_analysis_result']) {
                analysisContent = streamContent['ai_analysis_result'];
            } else if (streamContent['content_analysis_stream']) {
                analysisContent = streamContent['content_analysis_stream'];
            } else if (streamContent['compliance_check_stream']) {
                analysisContent = streamContent['compliance_check_stream'];
            } else {
                analysisContent = 'æ­£åœ¨ç­‰å¾…AIåˆ†æç»“æœ...';
            }
            
            aiAnalysisPreview.innerHTML = `<h5>AIåˆ†æç»“æœï¼š</h5><p>${analysisContent}</p>`;
            
            // è®¾ç½®ç­‰å¾…äººç±»åé¦ˆçŠ¶æ€
            isWaitingForHuman = true;
            
            addLog('ğŸ¤” æ‰‹åŠ¨è§¦å‘äººå·¥åé¦ˆç•Œé¢', 'info');
        }
        
        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
        }
        
        // ç”Ÿæˆéšæœºä¼šè¯ID
        document.getElementById('threadId').value = 'review_' + Math.random().toString(36).substr(2, 9);
    </script>
</body>
</html>
